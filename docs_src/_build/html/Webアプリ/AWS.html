

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AWS &#8212; Tak Documents  ドキュメント</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="HTML" href="HTML.html" />
    <link rel="prev" title="Webアプリ" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="HTML.html" title="HTML"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="index.html" title="Webアプリ"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Tak Documents  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Webアプリ</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../sphinx/index.html">Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GitHub/index.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VirtualBox/index.html">VirtualBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Linux/index.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../raspberry_pi/index.html">Raspberry Pi</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Webアプリ</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="HTML.html">HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="CSS.html">CSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bootstrap.html">Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="JavaScript.html">JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="Flask/index.html">Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ruby.html">Ruby</a></li>
<li class="toctree-l2"><a class="reference internal" href="MySQL.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ruby on Rails.html">Ruby on Rails</a></li>
<li class="toctree-l2"><a class="reference internal" href="共通のメモ.html">共通のメモ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../デザインパターン/index.html">デザインパターン</a></li>
<li class="toctree-l1"><a class="reference internal" href="../備忘録/index.html">備忘録</a></li>
</ul>

  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">AWS</a><ul>
<li><a class="reference internal" href="#id1">概要</a></li>
<li><a class="reference internal" href="#id2">初期設定</a></li>
<li><a class="reference internal" href="#id3">操作</a></li>
<li><a class="reference internal" href="#vpc">【VPC】ネットワーク構築</a><ul>
<li><a class="reference internal" href="#id4">用語</a></li>
<li><a class="reference internal" href="#id5">手順</a></li>
<li><a class="reference internal" href="#id6">補足</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ec2web">【EC2】Webサーバ構築</a><ul>
<li><a class="reference internal" href="#id7">用語</a></li>
<li><a class="reference internal" href="#id8">手順</a></li>
<li><a class="reference internal" href="#id9">補足</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="index.html"
                        title="前の章へ">Webアプリ</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="HTML.html"
                        title="次の章へ">HTML</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="aws">
<h1>AWS<a class="headerlink" href="#aws" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="id1">
<h2>概要<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul>
<li><p class="first">サービスの数は世界最大</p>
</li>
<li><p class="first">リソースが柔軟</p>
</li>
<li><p class="first">従量課金で使用した分だけ支払えばよい</p>
</li>
<li><p class="first">マネジメントコンソール</p>
<p>AWSログイン時に表示される画面のこと</p>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2>初期設定<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li>CloudWatchで料金アラートを設定<ul>
<li>請求ダッシュボードで請求アラートを受け取れるように設定<ul>
<li>マネジメントコンソール画面のメニューバーのアカウントより、マイ請求ダッシュボードを選択</li>
<li>左メニューから、Billing の設定を選択し各々設定する</li>
</ul>
</li>
<li>CloudWatchで料金アラートを設定<ul>
<li>CloudWatch-&gt;請求-&gt;アラームの作成</li>
<li>メトリクス-&gt;請求-&gt;概算合計請求額を選択し、チェックボックスにチェックを入れる</li>
<li>メトリクスの選択ボタンを押下</li>
<li>閾値金額を入力（例：10USD）</li>
<li>次へボタンを押下</li>
<li>トピック名とメアドを入力し、トピックの作成ボタンを押下</li>
<li>次へボタンを押下</li>
<li>名前と説明を入力し、次へボタンを押下</li>
<li>アラームの作成ボタンを押下</li>
<li>上記メアドに通知メールがあるので、&quot;Confirm subscription&quot;ボタンを押下</li>
</ul>
</li>
</ul>
</li>
<li>マネジメントコンソール画面のメニューバーのアカウントより、マイアカウント-&gt;IAMユーザーによる請求情報へのアクセス有効化で「有効」に設定</li>
<li>IAMで作業ユーザを作成</li>
<li>CloudTrailで操作ログを記録<ul>
<li>デフォルトで有効になっているが、保存期間は90日のみ</li>
<li>S3に操作ログを保存することで、永久的に保存できる</li>
<li>ただし、CloudTrail自体は無料だが、S3の料金は必要</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2>操作<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li>操作ログ閲覧方法<ul>
<li>サービス-&gt;CloudTrail-&gt;最近のイベント を閲覧する</li>
<li>デフォルト保存期間は90日</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="vpc">
<h2>【VPC】ネットワーク構築<a class="headerlink" href="#vpc" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id4">
<h3>用語<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>リージョン<ul>
<li>AWSの各サービスが提供されている地域のことであり、各国に存在する</li>
<li>基本的には、最新サービスはまずアメリカリージョンで提供され、それから他のリージョンに展開される</li>
</ul>
</li>
<li>アベイラビリティゾーン<ul>
<li>独立したデータセンターのこと</li>
<li>リージョン内にはアベイラビリティゾーンが複数あり、災害等で1つが使用できなくなっても他で代替できる</li>
</ul>
</li>
<li>VPC<ul>
<li>Virtual Private Cloud</li>
<li>AWS上に仮想ネットワークを作成できるサービス</li>
<li>IPv4 アドレスの範囲を CIDRブロックの形式で指定する必要がある (例: 10.0.0.0/16)。</li>
<li>プライベートIPアドレスを使用することが推奨されている<ul>
<li>クラスA：10.0.0.0～10.255.255.255 （10.0.0.0/8）</li>
<li>クラスB：172.16.0.0～172.31.255.255 （172.16.0.0/12）</li>
<li>クラスC：192.168.0.0～192.168.255.255 （192.168.0.0/16）</li>
</ul>
</li>
<li>VPC作成後はIPv4 アドレス範囲を変更できないので、大きめに設定する<ul>
<li>大きさは /28から/16で、/16が推奨</li>
</ul>
</li>
</ul>
</li>
<li>サブネット<ul>
<li>VPCを細かく区切ったネットワークであり、プライベート／パブリックの設定が可能</li>
<li>これにより、サブネットAは公開するが、サブネットBは非公開とする、ことでセキュリティを高める運用が可能</li>
<li>アベイラビリティゾーンを分けて配置することで、物理的な場所を離すことで、災害に強くなるメリットもある</li>
<li>IPv4 アドレス範囲は/24が標準的</li>
</ul>
</li>
<li>IPアドレスの表記<ul>
<li>CIDR表記（サイダー）<ul>
<li>Classless Inter-Domain Routing</li>
<li>例：192.168.128.0/24</li>
<li>&quot;/&quot;の後の数値24は、ネットワーク部が先頭から24ビット目までであることを表す</li>
</ul>
</li>
<li>サブネットマスク表記<ul>
<li>例：192.168.128.0/255.255.255.0</li>
</ul>
</li>
</ul>
</li>
<li>ルートテーブル<ul>
<li>VPCと各サブネットに対して設定できる</li>
<li>ルートテーブルに設定している送信先IPアドレス範囲（CIDRブロック）以外の通信は破棄される</li>
<li>&quot;0.0.0.0/0&quot;で、ルートテーブルに設定しているIPアドレス範囲以外のIPアドレスを意味する</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id5">
<h3>手順<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>VPCを作成する<ul>
<li>テナンシー：デフォルト</li>
<li>VPCを作成すると、自動的にメインルートテーブルとメインネットワークACLが作成される？</li>
</ul>
</li>
<li>サブネットを作成する<ul>
<li>パブリックサブネットを作成する</li>
<li>プライベートサブネットを作成する</li>
<li>VPCには、上記で作成したVPCを選択する</li>
<li>ルートテーブルとネットワークACLを明示的に設定しないと、VPCに設定されたメインルートテーブルとメインネットワークACLが利用される</li>
</ul>
</li>
<li>ルーティングを設定する<ul>
<li>インターネットゲートウェイを作成し、VPCにアタッチする<ul>
<li>作成したIGWを選択し、アクション-&gt;VPCにアタッチを選択</li>
</ul>
</li>
<li>ルートテーブルを作成し、パブリックサブネットに紐づける<ul>
<li>作成したルートテーブルを選択し、サブネットの関連付け-&gt;サブネットの関連付けの編集より、紐づけるサブネットを選択し保存する</li>
<li>作成したルートテーブルを選択し、ルート-&gt;ルートの編集-&gt;ルートの追加より、以下のルートを追加する<ul>
<li>送信先：&quot;0.0.0.0/0&quot;</li>
<li>ターゲット：Internet Gateway-&gt;作成したIGW</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id6">
<h3>補足<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>異なるシステムの場合はアカウントを分けること</li>
<li>同一システムで本番環境とステージング環境を分けたい場合は、同一アカウントでVPCとリージョンを分けるのがオススメ</li>
</ul>
</div>
</div>
<div class="section" id="ec2web">
<h2>【EC2】Webサーバ構築<a class="headerlink" href="#ec2web" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id7">
<h3>用語<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">EC2</p>
<ul class="simple">
<li>Elastic Compute Cloud</li>
<li>AWSクラウド上の仮想サーバ</li>
<li>数分で起動し、1時間または秒単位で従量課金</li>
<li>無料枠内でいくつEC2インスタンスを作成してもよいが、全インスタンスの稼働時間が750時間／月を超えると課金される</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">EC2インスタンスを一旦終了すると、グローバルIPアドレスが変わるので要注意！</p>
</div>
</li>
<li><p class="first">AMI（アミイ）</p>
<ul class="simple">
<li>Amazon Machine image</li>
<li>インスタンス起動に必要な情報が入ったOSのイメージ</li>
<li>サーバのテンプレートのようなもの</li>
<li>AWSやサードパーティがAMIを提供</li>
<li>カスタムAMIも作成可能</li>
<li>AMIから何台でもEC2インスタンスを起動可能</li>
</ul>
</li>
<li><p class="first">インスタンスタイプ</p>
<ul class="simple">
<li>サーバのスペックを定義したもの</li>
<li>インスタンスタイプにより、CPU、メモリ、ストレージ、ネットワーク帯域が異なる</li>
<li>例：m5.xlarge<ul>
<li>m<ul>
<li>インスタンスファミリー</li>
<li>インスタンスの特徴を示す</li>
<li>汎用的／CPU最適化／メモリ最適化／価格最適化／など</li>
</ul>
</li>
<li>5<ul>
<li>インスタンス世代</li>
<li>数値が大きいほど世代が新しい</li>
<li>新しいものの方が性能／コストパフォーマンス／などがよい</li>
<li>大きな数値を使用することが推奨</li>
</ul>
</li>
<li>xlarge<ul>
<li>インスタンスサイズ</li>
<li>CPU、メモリ、ネットワークのキャパシティを示す</li>
<li>small/large/xlarge/など</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">ストレージ</p>
<ul>
<li><p class="first">サーバにくっつけるデータの保管場所</p>
</li>
<li><p class="first">EC2には以下の2種類がある</p>
<ul>
<li><p class="first">EBS（Elastic Block Store）</p>
<ul class="simple">
<li>高い可能性と耐久性を持つストレージ</li>
<li>他のインスタンスに付け替え可能</li>
<li>EBSの費用が別途発生</li>
<li>OSやDBなどの永続性と耐久性が必要なデータを置く</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">無料利用枠では 30 GB までの EBS 汎用 (SSD) ストレージまたはマグネティックストレージを取得できる。</p>
</div>
</li>
<li><p class="first">インスタンスストア</p>
<ul class="simple">
<li>インスタンス専用の一時的なストレージ</li>
<li>他のインスタンスに付け替えることはできない</li>
<li>追加費用なし（無料）</li>
<li>一時ファイル、キャッシュなど、失われても問題がないデータを置く</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">SSH</p>
<ul class="simple">
<li>サーバと自分の目の前のパソコンをセキュアにつなぐサービスのこと</li>
<li>通信内容が暗号化された遠隔ログインシステム</li>
<li>公開鍵認証にてログインする</li>
<li>サーバにログインする際は基本的にSSHを使用する</li>
<li>EC2にログインする際はSSHを使用する</li>
<li>SSH接続のツールはTeraTermなど複数あるが、rloginがオススメ</li>
</ul>
</li>
<li><p class="first">公開鍵認証</p>
<ul class="simple">
<li>サーバ側が「公開鍵」を保有し、ユーザ側が「秘密鍵」を保有する</li>
<li>EC2作成時にダウンロードしたSSHキーペアが「秘密鍵」となる</li>
<li>ログインフロー<ol class="arabic">
<li>PC → サーバ：ログインを要求</li>
<li>サーバ → PC：適当なデータを公開鍵で暗号化し送信</li>
<li>PC → サーバ：受信したデータを複合化し平文データを送信</li>
<li>サーバ：元データとの一致を確認</li>
<li>サーバ → PC：ログインを許可</li>
</ol>
</li>
</ul>
</li>
<li><p class="first">ポート番号</p>
<ul class="simple">
<li>ポート番号は、プログラムのアドレス</li>
<li>同一コンピュータ内で通信を行うプログラムを識別する時に利用</li>
<li>ポート番号を決める方法は2種類ある<ul>
<li>標準で決められている番号<ul>
<li>ウェルノウンポート番号と呼ばれる</li>
<li>ウェルノウンポート番号は0～1023</li>
<li>例：SSHは22、SMTPは25、HTTPは80、HTTPSは443</li>
</ul>
</li>
<li>動的に決まる番号<ul>
<li>サーバのポート番号は決まっている必要があるが、クライアントのポート番号は決まってなくてもよい</li>
<li>クライアントのポート番号は、OSが他のポート番号と被らないようにランダムに決める</li>
<li>番号は49142～65535</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">Apache</p>
<p>HTTPリクエストがあると、それに対してレスポンスを返しWebページを表示する、Webサーバのソフトウェア。</p>
</li>
<li><p class="first">ファイアウォール</p>
<ul class="simple">
<li>ファイアウォールとは、ネットワークを不正アクセスから守るために、「通してよい通信だけを通して、それ以外は通さない」機能の総称</li>
<li>AWSでは、EC2インスタンスに対して設定する <strong>セキュリティグループ</strong> がファイアウォールの役割を担っている。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id8">
<h3>手順<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">EC2インスタンスを設置する</p>
<ul>
<li><p class="first">AMIの選択</p>
<ul class="simple">
<li>EC2-&gt;インスタンス-&gt;インスタンスの作成を選択する</li>
<li>クイックスタート-&gt;Amazon Linux 2 AMIを選択し選択ボタンを押下する</li>
</ul>
</li>
<li><p class="first">インスタンスタイプの選択</p>
<ul class="simple">
<li>無料枠で利用できる&quot;t2.micro&quot;を選択し次のステップボタンを押下する</li>
</ul>
</li>
<li><p class="first">インスタンス詳細の設定</p>
<ul class="simple">
<li>インスタンス数：1</li>
<li>購入のオプション：チェックなし（常時インスタンスを起動したいためスポットインスタンスではない）</li>
<li>ネットワーク：作成したVPCを選択</li>
<li>サブネット：作成したパブリックサブネットを選択</li>
<li>自動割り当てパブリックIP：有効（インターネット経由でアクセスしたいため）</li>
<li>配置グループ：チェックなし（複数インスタンスがある場合にインスタンス間のアクセスを高速化するために利用するもの）</li>
<li>キャパシティーの予約：なし（EC2インスタンスが必ず利用できるように予め予約すると追加料金が発生するため）</li>
<li>IAMロール：なし（EC2インスタンスが他のAWSサービスと連携する際の権限を設定するもの）</li>
<li>シャットダウン動作：停止（終了時にEC2インスタンスを削除する必要がないため）</li>
<li>終了保護の有効化：チェックなし（EC2インスタンスが誤って削除されることを防ぐためのもの。本番環境では利用する場合あり）</li>
<li>モニタリング：チェックなし（EC2インスタンスの監視周期を5分→1分にするためのもの。追加料金発生）</li>
<li>テナンシー：共有（ハードウェアを占有する際に利用するもの）</li>
<li>Elastic Inference：チェックなし（機械学習でGPUを使用する場合にコストパフォーマンスをよくするためのもの）</li>
<li>T2/T3無制限：チェックなし（T2/T3系インスタンスには留意点あり。
CPU使用率にベースライン（CPU資料率10%）が設定されており、これ以下で運用されている場合はCPUクレジットが貯まっていく。
アクセスが集中するなど、CPU使用率がベースラインを超えた場合は、バーストモードで動作し、CPUクレジットを消費していく。
CPUクレジットが消費され尽くすと、バーストモードでは動作できなくなり負荷増となる。
このバーストモードを無制限とするために利用される項目である。
ただし、追加料金が発生する）</li>
<li>ネットワークインターフェイス-&gt;プライマリIP：例）10.0.10.10（
パブリックIPアドレスだけでなく、プライベートIPアドレスを持たせることができる。
パブリックサブネットのプライベートIPアドレスが10.0.10.0/24の場合、その範囲内で設定する）</li>
<li>高度な詳細-&gt;ユーザーデータ：空欄（インスタンス起動時に実行するスクリプトを設定できる）</li>
</ul>
</li>
<li><p class="first">ストレージの追加</p>
<ul class="simple">
<li>新しいボリュームの追加はしない</li>
<li>サイズ：8GB</li>
<li>ボリュームタイプ：汎用SSD</li>
<li>終了時に削除：チェックあり</li>
<li>暗号化：暗号化なし</li>
</ul>
</li>
<li><p class="first">タグの追加</p>
<ul class="simple">
<li>&quot;タグを追加&quot;ボタンを押下し、インスタンスの名前を設定する</li>
<li>キー：Name、値：インスタンス名</li>
</ul>
</li>
<li><p class="first">セキュリティグループの設定</p>
<ul class="simple">
<li>セキュリティグループ名を設定する</li>
<li>タイプ、ソースはデフォルトのまま</li>
<li>ただし、ソースを0.0.0.0/0にすると、どこからでもSSH接続できるようになるので危険</li>
<li>今回はとりあえずデフォルト（0.0.0.0/0）とする</li>
</ul>
</li>
<li><p class="first">SSHキーペアの設定</p>
<ul class="simple">
<li>SSH接続で使用するキーのこと</li>
<li>「新しいキーペアの作成」を選択</li>
<li>キーペア名を任意に入力し、「キーペアのダウンロード」ボタンを押下することで、&quot;～～.pem&quot;ファイルが作成される</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">このキーペアは後で作成することができないため、必ずEC2インスタンス作成時に作成し、なくさないこと。</p>
</div>
</li>
</ul>
</li>
<li><p class="first">Apacheをインストールする</p>
<ul>
<li><p class="first">SSHでサーバにログイン</p>
<ul class="simple">
<li>接続先はEC2インスタンスの「IPv4 パブリック IP」である。
このアドレスはインスタンスの再起動の都度変わるので確認すること。</li>
<li>ユーザ名を&quot;ec2-user&quot;とし、上記で作成したSSHキーペアを読み込ませる。</li>
</ul>
</li>
<li><p class="first">Apacheをインストール</p>
<ul>
<li><p class="first">パッケージを更新する</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// yum：Linuxのパッケージ管理ツール。&quot;yum update&quot;でyumが管理する全パッケージを更新する。</span>
<span class="go">// -y：&quot;Yes&quot;オプション。全パッケージの更新を&quot;Yes&quot;にする。付けないと都度Yes/Noを聞かれる</span>
<span class="gp">$</span> sudo yum update -y
</pre></div>
</div>
</li>
<li><p class="first">Apacheをインストールする</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// httpd：Apacheを構成する実行ファイル</span>
<span class="gp">$</span> sudo yum -y install httpd
</pre></div>
</div>
</li>
<li><p class="first">Apacheを起動させる</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// httpd.service：Apacheのこと</span>
<span class="gp">$</span> sudo systemctl start httpd.service
</pre></div>
</div>
</li>
<li><p class="first">Apacheが起動しているか確認する1（Apacheのステータスを確認）</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo systemctl status httpd.service
<span class="go">● httpd.service - The Apache HTTP Server</span>
<span class="go">  Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)</span>
<span class="go">  Active: active (running) since Tue 2020-02-11 13:18:43 UTC; 33s ago</span>
<span class="go">    Docs: man:httpd.service(8)</span>
<span class="go">Main PID: 21785 (httpd)</span>
<span class="go">  Status: &quot;Total requests: 0; Idle/Busy workers 100/0;Requests/sec: 0; Bytes served/sec:   0 B/sec&quot;</span>
<span class="go">  CGroup: /system.slice/httpd.service</span>
<span class="go">          tq21785 /usr/sbin/httpd -DFOREGROUND</span>
<span class="go">          tq21786 /usr/sbin/httpd -DFOREGROUND</span>
<span class="go">          tq21787 /usr/sbin/httpd -DFOREGROUND</span>
<span class="go">          tq21788 /usr/sbin/httpd -DFOREGROUND</span>
<span class="go">          tq21789 /usr/sbin/httpd -DFOREGROUND</span>
<span class="go">          mq21790 /usr/sbin/httpd -DFOREGROUND</span>
</pre></div>
</div>
</li>
<li><p class="first">Apacheが起動しているか確認する2（全プロセスを確認）</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// ps：プロセスを表示するコマンド</span>
<span class="go">// -ax：全てのプロセスを表示するオプション</span>
<span class="go">// u：CPUやメモリ使用率を付けて表示するオプション</span>
<span class="gp">$</span> ps -axu
<span class="go">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span>
<span class="go">・・ 省略 ・・</span>
<span class="go">apache   21786  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/httpd</span>
<span class="go">apache   21787  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/httpd</span>
<span class="go">apache   21788  0.0  0.6 495156  6520 ?        Sl   13:18   0:00 /usr/sbin/httpd</span>
<span class="go">apache   21789  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/httpd</span>
<span class="go">apache   21790  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/httpd</span>
<span class="go">ec2-user 21839  0.0  0.3 164364  3900 pts/0    R+   13:22   0:00 ps -axu</span>
</pre></div>
</div>
</li>
<li><p class="first">Apacheが起動しているか確認する3（Apacheのプロセスを確認）</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// |：パイプライン。左のコマンドの実行結果を右のコマンドに渡す</span>
<span class="go">// grep：引数の文字列を検索して表示する</span>
<span class="gp">$</span> ps -axu <span class="p">|</span> grep httpd
<span class="go">root     21785  0.0  0.9 257372  9716 ?        Ss   13:18   0:00 /usr/sbin/http  -DFOREGROUND</span>
<span class="go">apache   21786  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/http  -DFOREGROUND</span>
<span class="go">apache   21787  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/http  -DFOREGROUND</span>
<span class="go">apache   21788  0.0  0.6 495156  6520 ?        Sl   13:18   0:00 /usr/sbin/http  -DFOREGROUND</span>
<span class="go">apache   21789  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/http  -DFOREGROUND</span>
<span class="go">apache   21790  0.0  0.6 298484  6512 ?        Sl   13:18   0:00 /usr/sbin/http  -DFOREGROUND</span>
<span class="go">ec2-user 21842  0.0  0.0 119416   920 pts/0    S+   13:27   0:00 grep --color=auto httpd</span>
</pre></div>
</div>
</li>
<li><p class="first">Apacheをサーバ起動に合わせて自動起動するよう設定する</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo systemctl <span class="nb">enable</span> httpd.service
</pre></div>
</div>
</li>
<li><p class="first">自動起動設定となったか確認する</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo systemctl is-enabled httpd.service
<span class="go">enabled</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">ファイアウォールを設定する</p>
<ul class="simple">
<li>現時点では、パブリックサブネットへのアクセスは、ポート22番（SSH接続）への通信のみOKの状態。</li>
<li>HTTPリクエストを通すために、セキュリティグループのポート80番を開ける。セキュリティグループのインバウンド設定にて、以下のルールを追加する<ul>
<li>タイプ：HTTP</li>
<li>プロトコル：TCP</li>
<li>ポート範囲：80</li>
<li>ソース：任意の場所</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id9">
<h3>補足<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">どのポート番号でどのプログラムが待ち受けているかを調べる</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// lsof：オープン中のファイルやそのファイルをオープンしているプロセスのリストを出力する</span>
<span class="go">//       &quot;list open files&quot; の略</span>
<span class="go">// -i：ネットワークソケットファイルを表示</span>
<span class="go">// -n：IPアドレスをホスト名に変換しないオプション</span>
<span class="go">// -P：ポート番号をサービス名に変換しないオプション</span>
<span class="go">// &quot;LISTEN&quot;：他のコンピュータから待ち受けているポートを示す。</span>
<span class="go">// &quot;ESTABLISHED&quot;：現在通信中のポートを示す。</span>
<span class="gp">$</span> sudo lsof -i -n -P
<span class="go">COMMAND    PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span>
<span class="go">rpcbind   2679      rpc    6u  IPv4  16789      0t0  UDP *:111</span>
<span class="go">rpcbind   2679      rpc    7u  IPv4  16793      0t0  UDP *:727</span>
<span class="go">rpcbind   2679      rpc    8u  IPv4  16794      0t0  TCP *:111 (LISTEN)</span>
<span class="go">rpcbind   2679      rpc    9u  IPv6  16795      0t0  UDP *:111</span>
<span class="go">rpcbind   2679      rpc   10u  IPv6  16796      0t0  UDP *:727</span>
<span class="go">rpcbind   2679      rpc   11u  IPv6  16797      0t0  TCP *:111 (LISTEN)</span>
<span class="go">chronyd   2702   chrony    1u  IPv4  17280      0t0  UDP 127.0.0.1:323</span>
<span class="go">chronyd   2702   chrony    2u  IPv6  17281      0t0  UDP [::1]:323</span>
<span class="go">dhclient  2910     root    6u  IPv4  17815      0t0  UDP *:68</span>
<span class="go">dhclient  3032     root    5u  IPv6  18132      0t0  UDP [fe80::4f4:e7ff:fe7f:da0c]:546</span>
<span class="go">master    3169     root   13u  IPv4  18980      0t0  TCP 127.0.0.1:25 (LISTEN)</span>
<span class="go">sshd      3388     root    3u  IPv4  20815      0t0  TCP *:22 (LISTEN)</span>
<span class="go">sshd      3388     root    4u  IPv6  20824      0t0  TCP *:22 (LISTEN)</span>
<span class="go">sshd     32416     root    3u  IPv4  56384      0t0  TCP 10.0.10.10:22-&gt;126.193.60.75:20586 (ESTABLISHED)</span>
<span class="go">sshd     32433 ec2-user    3u  IPv4  56384      0t0  TCP 10.0.10.10:22-&gt;126.193.60.75:20586 (ESTABLISHED)</span>
</pre></div>
</div>
<p>上記では、&quot;sshd&quot;というプログラムが、アドレス制限なしの22番ポートで待ち受けている。
このため、SSH接続できるのである。</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="HTML.html" title="HTML"
             >次へ</a> |</li>
        <li class="right" >
          <a href="index.html" title="Webアプリ"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Tak Documents  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Webアプリ</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, tak.
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5 で生成しました。
    </div>
  </body>
</html>